% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gutenberg_add_sections.R
\name{gutenberg_add_sections}
\alias{gutenberg_add_sections}
\title{Add a section column to a Gutenberg tibble}
\usage{
gutenberg_add_sections(
  data,
  pattern,
  ignore_case = TRUE,
  format_fn = NULL,
  group_by = "auto",
  section_col = "section"
)
}
\arguments{
\item{data}{A \link[tibble:tibble]{tibble::tibble} with a \code{text} column containing the text to analyze.
Typically \code{data} should be piped from \link{gutenberg_download} and contain a
\code{gutenberg_id} column, but this is not required.}

\item{pattern}{A regex pattern to identify headers. Must match the specific
formatting of your book. See Details and Examples for common patterns.}

\item{ignore_case}{Logical; should pattern matching be case-insensitive?
Default is \code{TRUE}.}

\item{format_fn}{Optional function to format section text. Receives the
matched text and returns formatted text. Common options include
\link[stringr:case]{stringr::str_to_title} and \link[stringr:case]{stringr::str_to_upper} but a custom function
can also be provided.}

\item{group_by}{Character vector of column names to group by before filling
sections, or \code{NULL} to disable grouping. Defaults to \code{"auto"}, which
automatically uses \code{"gutenberg_id"} if that column exists. Set to \code{NULL}
to treat the entire dataset as one document, or specify custom column
names for grouping (e.g., \code{group_by = "book_title"}).}

\item{section_col}{Character string specifying the name of the section column
to create. Defaults to \code{"section"}.}
}
\value{
A \link[tibble:tibble]{tibble::tibble} with an added column named according to
\code{section_col}, containing the section marker for each row. Rows before the
first section marker will have \code{NA}.
}
\description{
Identifies section markers (chapters, cantos, letters, etc.) in Project
Gutenberg texts and adds a column indicating which section each line belongs to.
Sections are forward-filled, so all text between markers belongs to the
previous section.
}
\details{
\subsection{Common Section Patterns for Project Gutenberg Books}{

Different books use different formatting for their section markers. Here are
patterns for common formats:
\itemize{
\item Chapters with Roman numerals: \code{"^Chapter [IVXLCDM]+"}
\item Chapters with Arabic numerals: \code{"^Chapter [0-9]+"}
\item Books (e.g., \emph{Paradise Lost}): \code{"^BOOK [IVXLCDM]+"}
\item Cantos (e.g., \emph{Dante's Inferno}): \code{"^CANTO [IVXLCDM]+"}
\item Staves (e.g., \emph{A Christmas Carol}): \code{"^STAVE [IVXLCDM]+"}
\item Parts or sections: \code{"^(PART|SECTION) [IVXLCDM0-9]+"}
\item Letters: \code{"^Letter [IVXLCDM0-9]+"}
\item Plays (acts and scenes): \code{"^(ACT|SCENE) [IVXLCDM]+"}
\item Multiple formats (e.g., \emph{Frankenstein}): \code{"^(Letter|Chapter) [0-9]+"}
}

Use \code{\link[=gutenberg_works]{gutenberg_works()}} to search for books and examine a few lines with
\code{\link[=gutenberg_download]{gutenberg_download()}} to determine the exact format before writing your pattern.
}
}
\examples{
\dontshow{if (interactive()) withAutoprint(\{ # examplesIf}
# Dante's Inferno - Cantos with Roman numerals
inferno <- gutenberg_download(1001) |>
  gutenberg_add_sections(pattern = "^CANTO [IVXLCDM]+")

# Frankenstein - Letters and Chapters, normalized to title case
frankenstein <- gutenberg_download(84) |>
  gutenberg_add_sections(
    pattern = "^(Letter|Chapter) [0-9]+",
    format_fn = stringr::str_to_title
  )

# Classic BrontÃ« works - Chapters with Roman numerals
# Remove trailing periods from section text
# Consider using `options(gutenbergr_cache_type = "persistent")`
# to prevent redownloading in the future.
bronte_sisters <- gutenberg_download(
  c(1260, 768, 969, 9182, 767),
  meta_fields = c("author", "title")
) |>
  gutenberg_add_sections(
    pattern = "^\\\\s*CHAPTER [IVXLCDM]+",
    format_fn = function(x) str_remove(x, "\\\\.$")
  )

# Leo Tolstoy's War and Peace
# Add two custom named columns for hierarchical sections
war_and_peace <- gutenberg_download(2600) |>
  gutenberg_add_sections(
    pattern = "^BOOK [A-Z]+",
    section_col = "book"
  ) |>
 gutenberg_add_sections(
   pattern = "^CHAPTER [IVXLCDM]+",
   section_col = "chapter"
 )
\dontshow{\}) # examplesIf}
}
